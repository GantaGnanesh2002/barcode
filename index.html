<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Barcode Ordering App</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f2f5;
    padding: 20px;
    max-width: 600px;
    margin: auto;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    background-color: #007bff;
    color: white;
    border: none;
    margin-top: 20px;
    cursor: pointer;
  }
  button:hover {
    background-color: #0056b3;
  }
  #message {
    margin-top: 20px;
    font-weight: 600;
    color: #333;
    min-height: 24px;
  }
  #order-section {
    margin-top: 30px;
    border-top: 1px solid #ccc;
    padding-top: 20px;
  }
</style>
</head>
<body>

<h1>Barcode Ordering App</h1>

<label for="barcodeInput">Scan or Enter Barcode:</label>
<input type="text" id="barcodeInput" placeholder="Scan or type barcode here" autocomplete="off" />

<div id="item-details" style="display:none;">
  <label>Item Name:</label>
  <input type="text" id="itemName" readonly />

  <label>Scale:</label>
  <input type="text" id="scale" readonly />

  <label>Department:</label>
  <input type="text" id="department" readonly />

  <div id="order-section">
    <label for="quantity">Select Quantity (1-10):</label>
    <select id="quantity">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>
    <button id="placeOrderBtn">Place Order</button>
  </div>
</div>

<div id="add-item-section" style="display:none;">
  <h3>Add New Item</h3>
  <label for="newItemName">Item Name:</label>
  <input type="text" id="newItemName" placeholder="Enter item name" />

  <label for="newScale">Scale:</label>
  <input type="text" id="newScale" placeholder="Enter scale" />

  <label for="newDepartment">Department:</label>
  <input type="text" id="newDepartment" placeholder="Enter department" />

  <button id="addItemBtn">Add Item</button>
</div>

<div id="delete-item-section" style="margin-top:30px;">
  <h3>Delete Item</h3>
  <label for="delBarcode">Barcode to Delete:</label>
  <input type="text" id="delBarcode" placeholder="Enter barcode" />

  <label for="delPassword">Password:</label>
  <input type="password" id="delPassword" placeholder="Enter password" />

  <button id="deleteItemBtn">Delete Item</button>
</div>

<div id="message"></div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycby1XkpTYsmkdgbf5FLWHBxgzub_3YoOXf_wmw_5PmrjZrUVSnQS839_ZgkGjVgnyt2T/exec';

const barcodeInput = document.getElementById('barcodeInput');
const itemDetailsSection = document.getElementById('item-details');
const addItemSection = document.getElementById('add-item-section');
const messageDiv = document.getElementById('message');

const itemNameInput = document.getElementById('itemName');
const scaleInput = document.getElementById('scale');
const departmentInput = document.getElementById('department');
const quantitySelect = document.getElementById('quantity');

const newItemName = document.getElementById('newItemName');
const newScale = document.getElementById('newScale');
const newDepartment = document.getElementById('newDepartment');

const delBarcodeInput = document.getElementById('delBarcode');
const delPasswordInput = document.getElementById('delPassword');

barcodeInput.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    searchItem(barcodeInput.value.trim());
  }
});

document.getElementById('placeOrderBtn').addEventListener('click', () => {
  placeOrder(barcodeInput.value.trim(), parseInt(quantitySelect.value));
});

document.getElementById('addItemBtn').addEventListener('click', () => {
  addItem(barcodeInput.value.trim());
});

document.getElementById('deleteItemBtn').addEventListener('click', () => {
  deleteItem(delBarcodeInput.value.trim(), delPasswordInput.value.trim());
});

function showMessage(msg, isError = false) {
  messageDiv.textContent = msg;
  messageDiv.style.color = isError ? 'red' : 'green';
}

function clearSections() {
  itemDetailsSection.style.display = 'none';
  addItemSection.style.display = 'none';
  messageDiv.textContent = '';
}

function searchItem(barcode) {
  if (!barcode) {
    showMessage('Please enter a barcode.', true);
    return;
  }
  clearSections();

  fetch(scriptURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'search', barcode })
  })
  .then(response => response.json())
  .then(data => {
    if (data.status === 'found') {
      // Show item details and order option
      itemDetailsSection.style.display = 'block';
      addItemSection.style.display = 'none';
      itemNameInput.value = data.item.itemName;
      scaleInput.value = data.item.scale;
      departmentInput.value = data.item.department;
      showMessage('Item found. You can place your order.');
    } else if (data.status === 'not_found') {
      // Show add item form
      addItemSection.style.display = 'block';
      itemDetailsSection.style.display = 'none';
      showMessage('Item not found. Please add item details.');
    } else {
      showMessage(data.message || 'Unknown response from server.', true);
    }
  })
  .catch(err => {
    showMessage('Error: ' + err.message, true);
  });
}

function addItem(barcode) {
  const name = newItemName.value.trim();
  const scale = newScale.value.trim();
  const dept = newDepartment.value.trim();

  if (!name || !scale || !dept) {
    showMessage('Please fill all item details.', true);
    return;
  }

  fetch(scriptURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'add_item',
      barcode,
      itemName: name,
      scale,
      department: dept
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      showMessage('Item added successfully.');
      // Reset form and reload item details
      newItemName.value = '';
      newScale.value = '';
      newDepartment.value = '';
      searchItem(barcode);
    } else {
      showMessage(data.message || 'Failed to add item.', true);
    }
  })
  .catch(err => {
    showMessage('Error: ' + err.message, true);
  });
}

function placeOrder(barcode, quantity) {
  if (!quantity || quantity < 1) {
    showMessage('Please select quantity.', true);
    return;
  }

  fetch(scriptURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'place_order',
      barcode,
      quantity
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      showMessage('Order placed successfully.');
      // Clear inputs for next entry
      barcodeInput.value = '';
      itemDetailsSection.style.display = 'none';
    } else {
      showMessage(data.message || 'Failed to place order.', true);
    }
  })
  .catch(err => {
    showMessage('Error: ' + err.message, true);
  });
}

function deleteItem(barcode, password) {
  if (!barcode || !password) {
    showMessage('Please enter barcode and password for deletion.', true);
    return;
  }

  fetch(scriptURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'delete_item',
      barcode,
      password
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      showMessage('Item deleted successfully.');
      delBarcodeInput.value = '';
      delPasswordInput.value = '';
    } else {
      showMessage(data.message || 'Failed to delete item.', true);
    }
  })
  .catch(err => {
    showMessage('Error: ' + err.message, true);
  });
}
</script>

</body>
</html>
