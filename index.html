<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mobile Barcode Scanner</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      text-align: center;
      color: #333;
    }

    h2 {
      font-size: 1.8rem;
      margin-top: 20px;
      color: #004080;
    }

    #reader {
      width: 100%;
      max-width: 360px;
      margin: 20px auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    #result {
      font-size: 1.3rem;
      background: #e0ffe0;
      color: #006600;
      padding: 10px;
      border-radius: 8px;
      margin: 20px;
      word-wrap: break-word;
    }

    #try-again {
      display: none;
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #try-again:hover {
      background-color: #0056b3;
    }

    @media (max-width: 480px) {
      h2 {
        font-size: 1.4rem;
      }
      #result {
        font-size: 1.1rem;
      }
      #try-again {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

  <h2>📷 Scan Barcode / QR Code</h2>
  <div id="reader"></div>
  <div id="result">Waiting for scan...</div>
  <button id="try-again">🔄 Try Again</button>

  <script>
    const resultElement = document.getElementById('result');
    const tryAgainBtn = document.getElementById('try-again');
    const readerId = "reader";

    let scanner = null;

    function startScanner() {
      scanner = new Html5Qrcode(readerId);
      scanner.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: { width: 250, height: 250 }
        },
        (decodedText, decodedResult) => {
          resultElement.innerText = `✅ Scanned Result: ${decodedText}`;
          tryAgainBtn.style.display = 'inline-block';
          scanner.stop().then(() => {
            document.getElementById(readerId).innerHTML = ""; // clear camera
          });
        },
        (errorMessage) => {
          // console.log(`Scan error: ${errorMessage}`);
        }
      ).catch((err) => {
        resultElement.innerText = `❌ Error: ${err}`;
      });
    }

    tryAgainBtn.addEventListener('click', () => {
      resultElement.innerText = 'Waiting for scan...';
      tryAgainBtn.style.display = 'none';
      startScanner();
    });

    // Start scanning when page loads
    startScanner();
  </script>

</body>
</html>
